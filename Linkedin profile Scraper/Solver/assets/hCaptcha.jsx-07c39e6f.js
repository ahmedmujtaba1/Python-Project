import{c as C}from"./solid-9116ffce.js";import{v as J}from"./package-292015a2.js";import{a as V,j as y}from"./utils-177944e6.js";let l=await chrome.storage.sync.get(null);await chrome.storage.sync.get(null);chrome.runtime.onMessage.addListener(function(v,E,k){if(v.action=="refresh_iframes")for(var x=document.getElementsByTagName("iframe"),S=0;S<x.length;S++)x[S].src=x[S].src});function z(){if(!l.apikey)return;function v(){return document.querySelector(".task-answers")!==null}function E(){return document.querySelectorAll(".task-image .image")?.length===9}function k(){return document.querySelector(".bounding-box-example")!==null}(async()=>{if(l.power===!1||l.hCap===!1)return;const x=e=>document.querySelector(e);function S(){const e=document.body.getBoundingClientRect();return e?.width===0||e?.height===0?!1:document.querySelector("div.check")!==null}function m(e){return new Promise(t=>setTimeout(t,e))}function P(e,t){return Math.floor(Math.random()*(t-e)+e)}function B(){try{const e=document.querySelector("div.check");return e&&e.style.display==="block"}catch(e){return console.error(e),!1}}const D=()=>!navigator.onLine||U||l.apikey===void 0||l.apikey==="";async function O(e){const t=await(await fetch(e)).blob();return new Promise(function(a){const i=new FileReader;i.readAsDataURL(t),i.addEventListener("loadend",function(){a(i.result.replace(/^data:image\/(png|jpeg);base64,/,""))}),i.addEventListener("error",function(){c&&console.log("❌ Failed to convert url to base64")})})}const[_]=C((await chrome.storage.sync.get("apikey")).apikey);C((await chrome.storage.sync.get("endpoint")).endpoint);const[A]=C((await chrome.storage.sync.get("plantype")).plantype);new URLSearchParams(location.hash);let j,U=!1;const F={"Content-Type":"application/json",apikey:_()},c=l.logs;for(;!D();)if(await m(1e3),l.autoOpen&&S()){if(B()&&(c&&console.log("found solved"),l.debug&&W(),l.hCAlwaysSolve===!1))break;x("#checkbox")?.click()}else l.autoSolve&&x("h2.prompt-text")!==null&&(l.logs&&c&&console.log("opening box"),await m(1e3),V(".interface-challenge","-1px"),await N());function W(){document.querySelectorAll("iframe").forEach(t=>{t.src=t.src})}async function H(){k()?(await m(200),document.querySelector(".display-language.button").click(),await m(100),document.querySelector(".language-selector .option:nth-child(23)").click()):E()?(await m(100),document.querySelector(".language-selector .option:nth-child(23)").click()):v()&&(document.querySelector(".display-language.button").click(),await m(200),document.querySelector(".language-selector .option:nth-child(23)").click(),await m(200))}async function N(){j=new Date;let e=[];if(l.english&&(document.documentElement.lang||navigator.language)!=="en"&&await H(),c&&console.log(e),!e!=[])return;const{target:t,cells:a,images:i,example:d,choices:r}=await $();if(!l.autoSolve)return;const u=new URLSearchParams(location.hash),g=v()?"multi":k()?"bbox":"grid";c&&console.log(g,t,a,i,d,r);try{e=i,c&&console.log(e);let n=await fetch(await X("solve"),{method:"POST",headers:F,body:JSON.stringify({images:i,target:t,method:"hcaptcha_base64",type:g,choices:v()?r:[],sitekey:u.get("sitekey"),site:u.get("host"),ln:document.documentElement.lang||navigator.language,softid:`chromeExt_V${J}`})});n=await n.json();const f=n.answer,o=n.message,s=n.status,b=n.url,q=P(250,350);c&&console.log(f,o,s,b,q);let h=0;if(n.error)c&&console.log(o),y("⚠"+o);else if(s==="skip")c&&console.log(o),y("⚠ "+o);else if(s==="new"){if(v()){const p=n.answer;console.log("multi",p),o&&y("⚠ "+o),await L(p),h=h+1}else if(E()){const p=await(await fetch(b)).json();o&&y("⚠ "+o);for(const w of p.solution)a[w].click(),await m(q)}else if(k()){const w=(await(await fetch(b)).json()).answer;if(o&&y("⚠ "+o),!w)return;w?.length===2&&(await I(w),h=h+1)}}else if(s==="solved"){if(v()){const p=n.answer;c&&console.log("multi",p),o&&y("⚠ "+o),await L(p),h=h+1,c&&console.log("multi hcap ~ clicks",h)}else if(E()){const p=G(n?.solution);o&&y("⚠ "+o);for(const w of p)a[w].click(),await m(q)}else if(k()){const w=(await(await fetch(b)).json()).answer;if(!w)return;o&&y("⚠ "+o),w?.length===2&&(await I(w),h=h+1)}}else s==="falied"&&(c&&console.log(o),y("⚠"+o));const T=new Date-j,M=v()?l.hcaptime_multi*1e3-T:k()?l.hcaptime_bbox*1e3-T:l.hcaptime*1e3-T;M<0&&await m(300),await m(M),document.querySelector(".button-submit").click(),j=0,e=[]}catch(n){y("⚠"+n),console.warn(n)}}function G(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e}function R(e){["mouseover","mousedown","mouseup","click"].forEach(t=>{if(e.fireEvent)e.fireEvent("on"+t);else{const a=document.createEvent("MouseEvents");a.initEvent(t,!0,!1),e.dispatchEvent(a)}})}async function I(e){function t(r,u,g){const n=r.getBoundingClientRect(),f=["mouseover","mousedown","mouseup","click"],o={clientX:u+n.left,clientY:g+n.top,bubbles:!0};for(let s=0;s<f.length;s++){const b=new MouseEvent(f[s],o);r.dispatchEvent(b)}}const a=document.querySelector("canvas");a.addEventListener("mousedown",function(r){const u=a.getBoundingClientRect(),g=event.clientX-u.left,n=event.clientY-u.top;c&&console.log("x: "+g+" y: "+n,e)});const[i,d]=e;t(a,i,d)}async function X(e){const t=(await chrome.storage.sync.get("endpoint")).endpoint;return A()==="custom"?"https://"+t+"/"+e:"https://"+A()+".nocaptchaai.com/"+e}async function L(e){for(const t of e){const a=[...document.querySelectorAll(".answer-text")].find(i=>i.outerText===t);R(a),[...document.querySelectorAll(".answer-example")].some(i=>i.style.backgroundColor==="rgb(116, 116, 116)")||R(a)}}async function Y(){const e=document.querySelector("canvas");if(!e)return null;const[t,a]=[e.width,e.height],d=e.getContext("2d").getImageData(0,0,t,a);if(Array.from(d.data).every((q,h)=>h%4===3||q===0))return console.error("The original canvas has no valid content"),null;const u=parseInt(e.style.width,10),g=parseInt(e.style.height,10);if(u<=0||g<=0)return console.error("Desired width and height should be positive numbers"),null;const n=Math.min(u/t,g/a),[f,o]=[t*n,a*n],s=document.createElement("canvas");return Object.assign(s,{width:f,height:o}),s.getContext("2d").drawImage(e,0,0,t,a,0,0,f,o),s.toDataURL("image/jpeg",.4).replace(/^data:image\/(png|jpeg);base64,/,"")}function $(e=500){return new Promise(async t=>{const a=setInterval(async function(){let i=document.querySelector(".prompt-text")?.textContent;if(!i)return;let d=null,r={},u={},g=[];if(E()){if(d=document.querySelectorAll(".task-image .image"),d.length!==9)return;for(let n=0;n<d.length;n++){const f=d[n];if(!f)return;const o=f.style.background.match(/url\("(.*)"/)?.at(1)||null;if(!o||o==="")return;r[n]=await O(o)}}else if(v()){const n=document.querySelector(".task-image .image").style.background;if(!n)return;let f="";try{f=await O(n.match(/url\("(.*)"/)?.at(1))||""}catch(s){c&&console.log(s)}if(!u)return;Object.assign(r,{[Object.keys(r).length]:f}),c&&console.log("images",r);const o=document.querySelectorAll(".answer-text");g=Array.from(o).map(s=>s.outerText)}else if(k()){const n=await Y();if(!n)return;c&&console.log("canvasImg",n),Object.assign(r,{[Object.keys(r).length]:n}),c&&console.log("images",r)}return clearInterval(a),t({target:i,cells:d,images:r,example:u,choices:g})},e)})}})()}z();
