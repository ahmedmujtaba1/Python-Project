import{T as R,j as E}from"./utils-177944e6.js";import{v as k}from"./package-292015a2.js";async function g(e){if(!e)return new Error(`Failed to fetch URL. Status code: ${t.status}`);const t=await fetch(e);if(!t.ok)return new Error(`Failed to fetch URL. Status code: ${t.status}`);const r=await t.blob();return new Promise((c,o)=>{const n=new FileReader;n.onloadend=()=>{n.result?c(n.result.replace(/^data:image\/(png|jpeg);base64,/,"")):o(new Error("Failed to convert to base64"))},n.readAsDataURL(r)})}function f(e){if(document.contains(e))for(const t of["mouseover","mousedown","mouseup","click"]){const r=document.createEvent("MouseEvents");r.initEvent(t,!0,!1),e.dispatchEvent(r)}}class s{static isWidgetFrame(){return document.querySelector(".recaptcha-checkbox")!==null}static isImageFrame(){return document.querySelector("#rc-imageselect")!==null}static isErrorSelect(){return document.querySelector(".rc-imageselect-error-select-more")?.style.display!=="none"}static isErrorDynamic(){return document.querySelector(".rc-imageselect-error-dynamic-more")?.style.display!=="none"}static isSubmitDisabled(){return document.querySelector("#recaptcha-verify-button")?.disabled===!0}static openImageFrame(){f(document.querySelector("#recaptcha-anchor"))}static submit(){document.querySelector("#recaptcha-verify-button")?.click()}static isExpired(){return document.querySelector(".recaptcha-checkbox-border")!==null}static clicAudioBtn(){return document.querySelector("#recaptcha-audio-button")?.click()}static is11(){return document.querySelectorAll(".rc-image-tile-11").length!==0}static src11(){return document.querySelectorAll(".rc-image-tile-11")?.src}static isDynamic33(){return document.querySelectorAll(".rc-imageselect-dynamic-selected").length!==0}static is33(){return document.querySelectorAll(".rc-imageselect-tile").length===9}static is44(){return document.querySelectorAll(".rc-imageselect-tile").length===16}static src44(){return document.querySelector(".rc-image-tile-44")?.src}static src33(){return document.querySelector(".rc-image-tile-33")?.src}static refreshIframes(){document.querySelectorAll("iframe").forEach(r=>{r.src=r.src})}static isSolved(){const t=document.querySelector(".recaptcha-checkbox")?.getAttribute("aria-checked")==="true",r=document.querySelector("#recaptcha-verify-button")?.disabled;return t||r}static hasErrors(){return[".rc-imageselect-error-select-more",".rc-imageselect-error-dynamic-more",".rc-imageselect-error-select-something"].some(r=>{const c=document.querySelector(r);return c&&getComputedStyle(c).display!=="none"&&c.tabIndex===0})}static isExpired(){return document.querySelector("#recaptcha-accessible-status")?.style.display!=="none"}static isRateLimited(){return document.querySelector(".rc-doscaptcha-header")!==null}static reload(){document.querySelector("#recaptcha-reload-button")?.click()}static isCellSelected(t){return t?.classList.contains("rc-imageselect-tileselected")}static getTarget(){return document.querySelector(".rc-imageselect-desc strong, .rc-imageselect-desc-no-canonical strong")?.innerText}static async onImagesReady(){for(;;){await new Promise(c=>setTimeout(c,100));const t=document.querySelectorAll(".rc-imageselect-tile"),r=document.querySelectorAll(".rc-imageselect-dynamic-selected");if(t.length>0&&r.length===0)return!0}}}function A(e){window.addEventListener("load",()=>{const t=document.body.appendChild(document.createElement("style")).sheet;t.insertRule(`.rc-imageselect-table-33, .rc-imageselect-table-42, .rc-imageselect-table-44 {transition-duration: ${1/e}s !important}`,0),t.insertRule(`.rc-imageselect-tile {transition-duration: ${4/e}s !important}`,1),t.insertRule(`.rc-imageselect-dynamic-selected {transition-duration: ${2/e}s !important}`,2),t.insertRule(`.rc-imageselect-progress {transition-duration: ${1/e}s !important}`,3),t.insertRule(`.rc-image-tile-overlay {transition-duration: ${1/e}s !important}`,4),t.insertRule("#rc-imageselect img {pointer-events: none !important}",5)})}const i=await chrome.storage.sync.get(null);A();async function h(e,t){const r=document.querySelectorAll(".rc-image-tile-wrapper"),c={};async function o(n){const l=await Promise.all(Array.from(r).map(async a=>g(a.querySelector("img").src)));return l.length===0&&n>0?(await new Promise(a=>setTimeout(a,1e3)),o(n-1)):(l.forEach((a,d)=>{c[d]=a}),c)}switch(e){case"split_33":return o(5);case"33":return await g(t);case"44":return await g(t);default:return console.warn("Invalid grid type:",e),{}}}let w=null;async function S(){const e=s.is44()?"44":s.is33()?"33":s.is11()?"split_33":null;if(!e)return;const[t,r,c]=await D(),o=e==="split_33"?await h(c,r):{0:await h(c,r)},n=JSON.stringify(o);if(n){if(n===w)return"skip";w=n,i.logs&&console.log(o,t,e),F(o,c,t,e)}}async function D(){const e=s.is44()?"44":s.is33()?"33":null;if(!e)return;const t=document.querySelector(".rc-imageselect-instructions strong")?.innerText;if(!t)return;const r=document.querySelector(`.rc-image-tile-${e}`)?.src;if(r)return[t,r,e]}async function I(){for(;i.power&&i.reCap&&i.RsolveType!=="audio";)if(await R.sleep(1e3),s.isWidgetFrame()&&i.RautoOpen&&s.openImageFrame(),s.isImageFrame()&&i.RautoSolve){const e=s.is44()?"44":s.is33()?"33":null;(e==="33"||e==="44")&&(await u(1e3),await S()!=="skip"&&await S())}}function m(){f(document.querySelector("#recaptcha-verify-button"))}async function y(e,t,r){const c="https://recap.nocaptchaai.com/solve",o={"Content-Type":"application/json",apikey:i.apikey};if(i.logs&&console.log("images",typeof e,e.length,e===null,e===void 0),!!e)try{return await(await fetch(c,{method:"POST",headers:o,body:JSON.stringify({images:e,target:t,type:r,softid:`chromeExt_V${k}`,method:"recaptcha2"})})).json()}catch(n){return E(`${n} + couldn't send solve request`,3e3),n}}async function F(e,t,r,c,o){const n=document.querySelector(".rc-imageselect-desc-no-canonical strong")?.textContent;if(!e)return;const l=await y(e,r||n,t);i.logs&&console.log(l);const a=document.querySelectorAll(".rc-image-tile-wrapper");if(!a)return;const d=await p(l);if(d){for(const v of d)f(a[v]),await u(i.RclickDelay);if(s.isDynamic33()===!1&&(i.logs&&console.log("dynamic",s.isDynamic33()),m(),s.isErrorSelect()||s.isErrorDynamic()))return i.logs&&console.log("error found, skipping"),s.reload();if(c)return q(r,d);if(o)return await u(i.RsubmitDelay*1e3),m(),await u(i.RsubmitDelay*1e3),b(r);await u(i.RsubmitDelay*1e3),m()}}let T=null;async function q(e,t){for(;document.querySelectorAll(".rc-image-tile-11").length<t.length;)await u(150);const r=document.querySelectorAll(".rc-image-tile-wrapper img"),c={};if(!t)return;for(const a of t)a>=0&&a<r.length?c[a]=await g(r[a].src):console.warn(`Index ${a} is out of range for cells array`);const o=JSON.stringify(c);if(o===JSON.stringify(T)||o==="{}")return;const n=await y(c,e,"split_33");if(!n)return;const l=await p(n);if(l){if(i.logs&&console.log(n),l.length==0)return m(),s.isErrorSelect()||s.isErrorDynamic()?(i.logs&&console.log("error found, skipping"),s.reload()):void 0;for(const a of l)f(r[a]),await u(i.RclickDelay);await u(1e3),q(e,l)}}async function b(e){const t=document.querySelector(".rc-imageselect-desc-no-canonical strong")?.textContent;i.logs&&console.log(t);const r=document.querySelectorAll(".rc-image-tile-wrapper img"),c=document.querySelector(".rc-image-tile-44")?.src;if(!c)return;const o=await y(await g(c),e||t,"44");if(!o)return;const n=await p(o);if(n){if(!n===[])return s.reload();if(i.logs&&console.log(o),n.length==0)return m();for(const l of n)await u(i.RclickDelay),f(r[l]);return m(),await u(i.RsubmitDelay*1e3),b(e)}}async function p(e){return e.status==="new"?(await(await fetch(e.url)).json()).solution||null:e.solution}function u(e){return new Promise(t=>setTimeout(t,e))}I();
